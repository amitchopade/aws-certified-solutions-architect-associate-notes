Load Balancing
--------------
- Load balancers are servers that forward internat traffic to multiple downstream servers (EC2 instances, ECS tasks, etc)
- Users connect to the LB, not directly to any instance.
- Why use one?
    - Spread load across multiple downstream instances, whilst exposing a single access point for the application
    - Seamlessly handle failures of downstream services.
    - Regular healthchecks on instances
    - Provide SSL termination (HTTPS) for websites
    - Enforce stickiness with cookies to ensure that a user can connect to same instance over time
        - Seems like you would want to avoid this and keep the system stateless, as would remove some availability guarantees.
    - High availbility across zones
    - Seperate public and private traffic.

- Why use an EC2 load balancer?
    - An ELB is a *managed* load balancer
        - AWS guarantees it will work, takes care of maintenance, and provides some configurability
        - Saves setting up and managing an on prem L
        - Integrated with many AWS services

- Types of AWS LBs
    - Classic LB (v1) - 2009
    - Application LB (v2) - 2016
    - Network LV (v2) - 2017
    - Recommended to use v2 LBs as they proivide more features
    - Can set up internal or external LBs for public or private traffic

- Health checks
    - Crucial for LBs, enable it to know if instances are in a healthy state to receive traffic and serve responses.
    - Checks done on a port and route (e.g. /healthcheck)
    - 200 means healthy, anything else means unhealthy

- Application LB
    - Layer 7 (application layer) in OSI model
    - LB to multiple HTTP applications across machines (target groups)
        - Microservices
    - LB to multiple applications on the same machine (containers)
        - *Very popular exam question!*
    - LB based on route in URL
    - LB based on host in URL
    - Useful for microservices and container-based applications
    - Has port mapping to redirect to a dynamic port

- ALB good to know
    - Can enable stickiness at the target group level
        - Same request goes to the same instances
        - Directly generated by the ALB, not application
    - Supposts HTTP, HTTPS, Websockets
    - Application servers do not see the client IP directly
        - *Very popular exam question!*
        - App server sees the LB IP
        - True IP of client inserted in the `X-Forwarded-For` header
        - We can also get Port (`X-Forwarded-Port` and protocol (`X-Forwarded-proto`)

- Network LB
    - Layer 4 (protocol layer) in OSI
    - Forward TCP traffic to your instances
    - Handle millions of requests per second
    - Support for static or elastic IP
    - Less latency ~100ms vs 400ms for ALB
    - Most often used for extreme performance, should not be default choice
    - Creation process is the same as for ALB

- Load balancers good to know
    - Classic LBs are deprecated
    - Use ALB for HTTP, HTTPS, Websockets traffic
    - Use NLB for TCP traffic
    - CLB and ALB support SSL certs and provide SSL termination
    - All LB have healthcheck
    - ALB can route based on host / path
    - ALB works great with ECS
    - LBs have static hostnames.
        - *Very popular exam question!*
        - Do not resolve and use underlying IP!
    - LBs can scale, but not instantly - contact AWS for a "warm-up" if massive load expected
    - NLB directly see the client IP
    - LB 503 (service unavailable) error code means at capacity or no registered targets.
    - If the LB cannot connect to target, check security groups!
